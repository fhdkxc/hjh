<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.classroom.mapper.NtcnMapper">
	<sql id="searchWhere">
		<if test="keyword != null and keyword != ''">
			AND     N.NTCN_CN LIKE '%' || #{keyword} || '%'
		</if>
	</sql>

	<resultMap type="ntcnVO" id="ntcnMap">
		<result property="ntcnCode" column="NTCN_CODE"/>
		<result property="ntcnWritngDt" column="NTCN_WRITNG_DT"/>
		<result property="ntcnSj" column="NTCN_SJ"/>
		<result property="ntcnCn" column="NTCN_CN"/>
		<result property="clasCode" column="CLAS_CODE"/>
		<result property="atchFileCode" column="ATCH_FILE_CODE"/>
		<result property="ntcnCnt" column="NTCN_CNT"/>
		<collection property="hrtchrVO" resultMap="hrtchrMap"></collection>
	</resultMap>
	
	<resultMap type="hrtchrVO" id="hrtchrMap">
		<result property="clasCode" column="CLAS_CODE"/>
		<result property="schulCode" column="SCHUL_CODE"/>
		<result property="mberId" column="MBER_ID"/>
		<result property="mberNm" column="MBER_NM"/>
		<result property="cmmnDetailCode" column="CMMN_DETAIL_CODE"/>
	</resultMap>
	
	<select id="getNoticeList" parameterType="map" resultMap="ntcnMap">
		WITH T AS(
		    SELECT  ROW_NUMBER() OVER(ORDER BY N.NTCN_CODE DESC) RNUM,
		            N.NTCN_CODE, N.NTCN_WRITNG_DT, N.NTCN_SJ, N.NTCN_CN,
		            N.CLAS_CODE, N.ATCH_FILE_CODE, N.NTCN_CNT,
		            H.MBER_ID, FN_GET_MBER_NM(H.MBER_ID) AS MBER_NM
		    FROM    NTCN N, HRTCHR H
		    WHERE   1=1
		    AND     N.CLAS_CODE = #{clasCode}
		    AND     N.CLAS_CODE = H.CLAS_CODE
		)
		SELECT  T.*
		FROM	T
		WHERE	T.RNUM BETWEEN (#{currentPage} * 10) - (10 - 1) AND (#{currentPage} * 10)
	</select>
</mapper>