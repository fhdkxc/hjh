package kr.or.ddit.school.controller;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.school.service.AfterSchoolService;
import kr.or.ddit.util.ArticlePage;
import kr.or.ddit.vo.AschaVO;
import lombok.extern.slf4j.Slf4j;

@RequestMapping("/afterSchool")
@Slf4j
@Controller
public class AfterSchoolController {
	
	@Autowired
	AfterSchoolService afterSchoolService;
	
	//방과후학교 목록
	@GetMapping
	public String afterSchool(@RequestParam(value="schulCode", required=false) String schulCode) {
//		afterSchool->schulCode : 7581092
		log.info("afterSchool->schulCode : " + schulCode);
//		model.addAttribute("schulCode", schulCode);
		return "afterSchool/afterSchoolList";
	}
	
	// 방과후학교 목록 ajax
	@ResponseBody
	@PostMapping("/afterSchoolList")
	public ArticlePage<AschaVO> afterSchoolListAjax(@RequestBody Map<String, Object> map) {
		log.info("map : "+map);
		
		// 방과후학교 리스트
		List<AschaVO> aschaVOList = this.afterSchoolService.afterSchoolList(map);
		log.info("afterSchoolList -> aschaVOList : " + aschaVOList);
		
		// 전체 방과후학교 수
		int total = this.afterSchoolService.getTotalAfterSchool(map);
		log.info("afterSchoolList -> total" + total);
		int size = 10;
		
		String keyword = map.get("keyword").toString();
		log.info("afterSchoolList ->keyword : "+keyword);
		
		// 페이지네이션
		ArticlePage<AschaVO> data = new ArticlePage<AschaVO>(total,
				Integer.parseInt(map.get("currentPage").toString()), size, aschaVOList, keyword);
		
		String url = "/afterSchool/afterSchoolList";
		data.setUrl(url);
		
		log.info("aschaVOList : "+aschaVOList);
		
		return data;
	}
	
	// 방과후학교 상세
	@ResponseBody
	@PostMapping("/afterSchoolDetail")
	public AschaVO afterSchoolDetail(@RequestBody AschaVO aschaVO) {
		log.info("detail->aschaVO : "+aschaVO);
		
		// ajax에서 보낸 데이터
		aschaVO.getSchulCode();
		aschaVO.getAschaCode();
		
		aschaVO = this.afterSchoolService.afterSchoolDetail(aschaVO);
		
		log.info("detail->aschaVO! : "+aschaVO);
		
		return aschaVO;
	}
	
	// 방과후학교 생성
	@GetMapping("/afterSchoolCreate")
	public String afterSchoolCreate(@RequestParam(value="schulCode") String schulCode) {
		
		return "afterSchool/afterSchoolCreate";
	}
	
	// 방과후학교 생성 ajax
	@ResponseBody
	@PostMapping("/afterSchoolCreateAjax")
	public int afterSchoolCreateAjax(@RequestBody AschaVO aschaVO) {
		log.info("afterSchoolCreateAjax -> aschaVO : "+ aschaVO);

		int result = this.afterSchoolService.afterSchoolCreate(aschaVO);
		log.info("afterSchoolCreateAjax -> result :" +result);
		
		return result;
	}
	
	// 방과후학교 수정
	@GetMapping("/afterSchoolUpdate")
	public String afterSchoolUpdate(@RequestParam(value="aschaCode") String aschaCode,
									@RequestParam(value="schulCode") String schulCode) {
		return "afterSchool/afterSchoolUpdate";
	}
	
	// 방과후학교 수정 ajax
	@ResponseBody
	@PostMapping("/afterSchoolUpdateAjax")
	public int afterSchoolUpdateAjax(@RequestBody AschaVO aschaVO) {
		log.info("afterSchoolUpdateAjax -> aschaVO : "+aschaVO);
		
		int result = this.afterSchoolService.afterSchoolUpdate(aschaVO);
		log.info("afterSchoolUpdateAjax -> aschaVO" + aschaVO);
		
		return result;
	}
	
	// 방과후학교 삭제
	@ResponseBody
	@PostMapping("/afterSchoolDelete")
	public int afterSchoolDelete(@RequestBody AschaVO aschaVO) {
		log.info("afterSchoolDelete -> aschaVO :" +aschaVO);
		aschaVO.getAschaCode();
		
		int result = this.afterSchoolService.afterSchoolDelete(aschaVO);
		log.info("afterSchoolDelete -> aschaCode! "+aschaVO);
		
		return result;
	}
	
	// 방과후학교 관리 메인화면
	@GetMapping("/afterSchoolMain")
	public String afterSchoolMain(@RequestParam(value="mberId") String mberId) {
		
		return "afterSchool/afterSchoolMain";
	}
	
	// 교사의 방과후화면 개설 목록
	@ResponseBody
	@GetMapping("/afterSchoolTeacherList")
	public List<AschaVO> afterSchoolTeacherList(@RequestParam(value="mberId") String mberId){
	    log.info("afterSchoolTeacherList -> mberId :" + mberId);
	    List<AschaVO> aschaVOList = this.afterSchoolService.afterSchoolTeacherList(mberId);
	    log.info("aschaVOList :" + aschaVOList);
	    
	    return aschaVOList;
	}
}
