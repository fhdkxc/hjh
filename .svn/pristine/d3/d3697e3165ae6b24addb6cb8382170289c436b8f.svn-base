<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!-- 네이버 스마트 에디터 JS -->
<script type="text/javascript" src="/resources/se2/js/HuskyEZCreator.js" charset="UTF-8"></script>
<!-- 그림판 -->
<!-- <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" /> -->
<!-- <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" /> -->
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> -->
<!-- <script type="text/javascript" src="/resources/js/jquery.min.js"></script> -->
<link type="text/css" rel="stylesheet" href="/resources/css/diary/bcPaint.css" />
<script type="text/javascript" src="/resources/js/diary/bcPaint.js"></script>
<style>
#DiaryContainer h3{
	font-size: 2.2rem;
	text-align: center;
	backdrop-filter: blur(4px);
	background-color: rgba(255, 255, 255, 1);
	border-radius: 50px;
	box-shadow: 35px 35px 68px 0px rgba(145, 192, 255, 0.5), inset -8px -8px 16px 0px rgba(145, 192, 255, 0.6), inset 0px 11px 28px 0px rgb(255, 255, 255);
	width: 370px;
	padding-top: 35px;
	padding-bottom: 35px;
	margin: auto;
	margin-bottom: 40px;
}

.DiaryAll{
	width: 1400px;
	margin: auto;
	backdrop-filter: blur(10px);
	background-color: rgba(255, 255, 255, 1);
	border-radius: 50px;
	box-shadow: 0px 35px 68px 0px rgba(145, 192, 255, 0.5), inset 0px -6px 16px 0px rgba(145, 192, 255, 0.6), inset 0px 11px 28px 0px rgb(255, 255, 255);
	padding: 50px 80px;
}


.DiaryAll .DiaryTit {
	display: flex;
	justify-content: space-between;
	position:relative;
}


.DiaryAll .title{
	font-size: 1.8rem;
	font-weight: 700;
	margin-top: 6px;
}

#insertBtn{
	display: block;
    margin: auto;
    text-align: center;
    background: #006DF0;
    padding: 15px 30px;
    font-size: 1rem;
    border: none;
    color: #fff;
    font-weight: 700;
    border-radius: 5px;
    margin-top: 30px;
    margin-bottom: 40px;
}

#insertBtn:hover{
	background: #ffd77a;
	transition: all 1s ease;
	color:#333;
}

/* 날씨 */
.weather {
    border: 1px solid #B0E0E6;
    background-color: #f2f9fa;
    opacity: 0.8;
    border-radius: 10px;
    text-align:center;
    height: 80px;
    width: 80px;
    line-height: normal;
    font-weight:bold;
    position: absolute;
    top: 20%;
    right:2%;
    transform: translate(10%, 60%);
    z-index: 2;
}

.weather_icon {
    margin-right: 5px;
    line-height: 1.3;
}
</style>
<script type="text/javascript">
// 네이버 스마트 에디터 API 시작
var oEditors = [];
	$(function() {
		nhn.husky.EZCreator.createInIFrame({
			oAppRef : oEditors,
			elPlaceHolder : "nttCn",
			//SmartEditor2Skin.html 파일이 존재하는 경로
			sSkinURI : '<c:url value="/resources/se2/SmartEditor2Skin.html"/>',
			htParams : {
				bUseToolbar : true,						// 툴바 사용 여부 (true:사용/ false:사용하지 않음)
				bUseVerticalResizer : false,			// 입력창 크기 조절바 사용 여부 (true:사용/ false:사용하지 않음)
				bUseModeChanger : false,				// 모드 탭(Editor | HTML | TEXT) 사용 여부 (true:사용/ false:사용하지 않음)
				bSkipXssFilter : true,					// client-side xss filter 무시 여부 (true:사용하지 않음 / 그외:사용)
				SE2M_FontName: {
					// 초기 글꼴 설정
					htMainFont: {'id': '나눔고딕','name': '나눔고딕','size': '12','url': '','cssUrl': ''} // 기본 글꼴 설정
				},
			}, // boolean
			fOnAppLoad : function(){},
			fCreator: "createSEditor2"
		});
	// 네이버 스마트 에디터 API 끝

	// 등록버튼 클릭 이벤트 시작
	$("#insertBtn").on("click",function(){
		var nttNm = $("#nttNm").val();
		var nttCn = oEditors.getById["nttCn"].getIR();	// 에디터에 적은 내용 가져오기
		var frm = new FormData($("#frm")[0]);			// 게시글 등록 변수
		
		// 게시글 null체크
		if (nttNm == null || nttNm == '') {
			alertError("제목을 입력해주세요.", "");
			return;
		} else if (nttCn == null || nttCn == '' || nttCn == '<br>') {
			alertError("내용을 입력해주세요.", "");
			return;
		}
		
		oEditors.getById["nttCn"].exec("UPDATE_CONTENTS_FIELD",[]);
		console.log($("#nttCn").val());
		
		// 게시글 등록 실행
		$.ajax({
			type: "post",
			url: "/diary/addDiaryAct",
			processData: false,
			contentType: false,
			data: frm,
			dataType: "text",
			beforeSend: function(xhr) {
				xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
			},
			success: function(result) {
				let res = "성공";
				let icon = "success";
				
				if (result != 1) { res = "실패"; icon = "error"; }
				
				Swal.fire({
			      title: "일기 등록을 " + res + "하였습니다.",
			      text: ' ',
			      icon: icon
				}).then(result => { 
					location.href = "/diary/goToDiaryList";
				});
			}
		})	
	}); // end insertBtn click
	
	// 날씨 api
	$.ajax({
		type: "get",
		url: "https://api.openweathermap.org/data/2.5/weather?q=daejeon&appid=ec911e343913cf4c59f72fbd172aa4af&units=metric",
		dataType: "json",
		success: function(data) {
			// 날씨 아이콘 변경
	    	const changeWeatherIcon = (description) => {
				let iconClass = '';
				let iconColor ='';
		        let weatherTxt = "";

				if (description == 'clear sky') {
					iconClass = 'fas fa-sun';
					iconColor = 'orange';
					weatherTxt = '맑음';
				} else if (description == 'few clouds') {
					iconClass = 'fas fa-cloud-sun';
					iconColor = 'gray';
					weatherTxt = '구름 조금';
				} else if (description.includes('clouds') || !(description == 'few clouds')) {
					iconClass = 'fas fa-cloud';
					iconColor = 'skyblue';
					weatherTxt = '구름 많음';
				} else if (description.includes('rain')) {
					iconClass = 'fas fa-cloud-rain';
					iconColor = 'skyblue';
					weatherTxt = '비';
				} else if (description == 'thunderstorm') {
					iconClass = 'fas fa-bolt';
					iconColor = 'gray';
					weatherTxt = '천둥번개';
				} else if (description == 'snow') {
					iconClass = 'fas fa-snowflake';
					iconColor = 'gray';
					weatherTxt = '눈';
				} else if (description == 'mist') {
					iconClass = 'fas fa-water';
					iconColor = 'gray';
					weatherTxt = '안개';
				}
				return { iconClass, iconColor, weatherTxt };
	        }

		    // 날씨 아이콘 추가 및 변경
		    const weatherDescription = data.weather[0].description;
		    const { iconClass, iconColor, weatherTxt } = changeWeatherIcon(weatherDescription);
		    const iconHtml = '<i class="' + iconClass + '" style="color: ' + iconColor + ';"></i>';
		    $('.weather_icon').html(iconHtml);
		    $('.currTemp').html(weatherTxt);
		} // end success
	});
	
}); // end ready
</script>
<%-- <h1>mberVO => ${mberVO}</h1> --%>
<div id="DiaryContainer">
	<h3>
		<img src="/resources/images/classRoom/diary/titleImg1.png" style="width:50px; display:inline-block; vertical-align:middel;">
		일기장
		<img src="/resources/images/classRoom/diary/titleImg2.png" style="width:50px; display:inline-block; vertical-align:middel;">
	</h3>
	<form id="frm">
		<div class="DiaryAll" style="width: 1400px; margin: auto; margin-bottom:50px;">
			<div class="DiaryTit">
				<table style="margin-bottom:6px;">
					<tr style="width:60%; height: 50px; font-size: 1.4rem; vertical-align: middle;">
						<td></td>
						<td><span class="currTemp"></span><span class="weather_icon" style="margin-left: 10px;"></span></td>
					</tr>
				</table>
			</div>
			<div class="DiaryTit">
				<input type="text"  class="form-control input-sm" style="width:95%;border:none;background: none;height: 50px;font-size: 1.4rem;display: inline-block;vertical-align: middle; margin-bottom:6px;" name="nttNm" id="nttNm" placeholder="제목을 입력해주세요.">
				<img src="/resources/images/classRoom/freeBrd/line.png" style="position: absolute;left: 0px;top: 10px;z-index: -1;">
			</div>
			<div class="mb-3" style="display:flex;">
				<div id="bcPaint"></div>
				<script type="text/javascript">
					$('#bcPaint').bcPaint();
				</script>
			</div>
			<div class="diary-cont">
				​​​​​​​​<div id="smarteditor">
					<textarea name="nttCn" id="nttCn" style="width: 100%; height: 412px;"></textarea>
				</div>
			</div>
			​​​​​​​​<input type="button" value="등록" id="insertBtn"/>
		</div>
	</form>
</div>
